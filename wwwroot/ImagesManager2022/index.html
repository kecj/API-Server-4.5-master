<!-- 
    TRAVAIL FINAL
    PictaCloud, gestionnaire d'image
    Déveleppé par Kyle Delisi et Anthony Boutin Dufour,
    15 décembre 2022
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Images Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
    <link rel="manifest" href="images/site.webmanifest">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="css/site.css">
</head>

<body>

    <div class="mainContainer">
        <div class="headerPanel">
            <div class="headerLayout">
                <img src="images/camera.png" alt="" data-toggle="tooltip" class="favicon" title="Gestionnaire d'images">
                <div style="display:flex" id="header-logo">
                    <span class="header outLinedText tbg-yellow">
                        P
                    </span>
                    <span class="header outLinedText tbg-orange">
                        I
                    </span>
                    <span class="header outLinedText tbg-red">
                        C
                    </span>
                    <span class="header outLinedText tbg-pink ">
                        T
                    </span>
                    <span class="header outLinedText tbg-black">
                        A
                    </span>
                    <span class="header outLinedText tbg-purple">
                        C
                    </span>
                    <span class="header outLinedText tbg-blue">
                        L
                    </span>
                    <span class="header outLinedText tbg-green">
                        O
                    </span>
                    <span class="header outLinedText tbg-grass">
                        U
                    </span>
                    <span class="header outLinedText tbg-yellow">
                        D
                    </span>
                </div>
                <div class="toolBar" id="toolBar">
                    <span class="cmd fa fa-arrow-down-wide-short add-icon header-icons" id="sortCmd"
                        title="Trier les images" data-toggle="tooltip"></span>
                    <span class="cmd fa fa-search header-icons" title="Afficher/masquer la barre de recherche"
                        data-toggle="tooltip"></span>
                    <span class="cmd fa fa-plus-square add-icon header-icons" id="newImageCmd" title="Ajouter un image"
                        data-toggle="tooltip"></span>
                </div>
                <div id="searchBar">
                    <div class="searchBarLayout">
                        <select id="searchCategory" class="form-control">
                            <!-- filled programmatically-->
                        </select>
                        <span> <!-- skip a column --> </span>
                        <input type="search" id="searchTitle" class="form-control"
                            placeholder="Recherche de nouvelles" />
                        <span> <!-- skip a column --> </span>
                        <span class="cmd fa fa-refresh"></span>
                    </div>
                </div>
            </div>
            <div class="disconnected-header" id="disconnected-header">
                <span class="cmd fa fa-right-to-bracket header-icons" id="loginCmd" title="Connectez-vous"
                    data-toggle="tooltip"></span>
                <span class="cmd fa fa-user-plus header-icons" id="subscribeCmd" title="Inscrivez-vous"
                    data-toggle="tooltip"></span>
            </div>
            <div class="connected-header" id="connected-header">
                <img class="avatar header-icons" id="profileAvatar" src="No_Avatar.png" alt="user_avatar">
                <span class="header-icons" id="profileName"></span>
                <span class="cmd fa fa-user-tie header-icons" id="profileDataCmd" title="Afficher le profile"
                    data-toggle="tooltip"></span>
                <span class="cmd fa fa-arrow-right-from-bracket header-icons" id="logoutCmd" title="Déconnectez-vous"
                    data-toggle="tooltip"></span>
                <span class="cmd fa fa-check header-icons" id="verifyCmd" title="Verifier-vous"
                    data-toggle="tooltip"></span>
            </div>
        </div>

        <div class="scrollContainer">
            <div id="imagesList">
                <!-- filled programmatically-->
            </div>
        </div>

        <!-- Dialog des créateurs -->

        <div>
            <div id="CreatorsDlg">
                <h4>PICTACLOUD Creators : </h4>
                <br>
                Kyle Delisi
                Anthony Boutin-Dufour
                <br>
            </div>
        </div>

        <!-------------------------->

        <!--- Dialog des images ---->

        <div id="imageDlg">
            <form id="imageForm">
                <input type="hidden" id="Id_input" value="0">
                <input type="hidden" id="date_input" value="0">
                <input type="hidden" id="GUID_input" value="">

                <label for="title_input">Titre</label>
                <input type="text" id="title_input" class="form-control" required>

                <label for="decription_input">Description</label>
                <textarea id="description_input" class="form-control" required></textarea>

                <label for="image">Image</label>
                <div id='image' class='ImageUploader' defaultImage='images/No_Image.png'
                    waitingImage='images/writing.gif'>
                </div>
                <div class="note">Cliquez-Déposez une image</div>
                <label for="shared_input">Partager</label>
                <input type="checkbox" id="shared_input">
            </form>
        </div>
        <div id="imageShownDlg">
            <img id="avatar_shown" class="avatar" src="" alt="avatar">
            <span id="username_shown"></span>
            <br>
            <br>
            <div id="title_shown"></div>
            <br>
            <div id="description_shown"></div>
            <br>
            <a href="" id="image_shown_link"> <img id="image_shown" src="" alt="image"></a>
            <br>
            <div id="date_shown"></div>
        </div>
        <div id="confirmDeleteImgDlg">
            <span id="confirmationMessage"><span>Voulez-vous vraiment effacer votre image?</span></span>
        </div>

        <!-------------------------->

        <!--- Dialog de comptes ---->
        <div id="AccountCreationDlg">
            <form id="CreationForm">
                <input type="hidden" id="Idreg_input" value="0">
                <input type="hidden" id="Avatar_GUID_input" value="">

                <label for="username_input">Nom d'usager</label>
                <input type="text" id="username_input" class="form-control" required>

                <label for="email_input">Courriel</label>
                <input type="email" id="emailreg_input" class="form-control" required></textarea>

                <label for="password_input">Mot de passe</label>
                <input type="password" id="passwordreg_input" class="form-control">

                <label for="confirmation_input">Confirmation</label>
                <input type="password" id="confirmationreg_input" class="form-control">


                <label for="avatar">Avatar</label>
                <div id='avatar' class='ImageUploader' defaultImage='images/No_Avatar.png'
                    waitingImage='images/writing.gif'>
                </div>
                <div class="note">Cliquez-Déposez votre avatar</div>
            </form>
        </div>
        <div id="AccountLogoutDlg">
            <span id="LogoutMessage"></span>
        </div>
        <div id="AccountLoginDlg">
            <form id="LoginForm">
                <label for="email_input">Courriel</label>
                <input type="email" id="email_input" class="form-control" required></textarea>

                <label for="password_input">Mot de passe</label>
                <input type="password" id="password_input" class="form-control" required>

                <input type="checkbox" id="password_remember"> Se souvenir de moi
            </form>
        </div>
        <div id="EmailVerification">
            <input type="hidden" id="Id_input" value="0">
            <span id="VerificationMessage">Consultez votre boite de courriel pour connaitre votre code de vérification
                et inscrivez-le ci-dessous</span>
            <label for="Verification_input">Code vérification</label>
            <input type="text" id="Verification_input" class="form-control" required>
        </div>
        <div id="confirmDeleteAccountDlg">
            <span id="confirmationMessage"><span>Voulez-vous vraiment effacer votre compte?</span></span>
        </div>

        <!-------------------------->

        <!---   Dialog autres   ---->

        <div id="errorDlg">
            <span id="errorMessage"></span>
        </div>

        <!-------------------------->

    </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.maskedinput/1.4.1/jquery.maskedinput.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="js/customValidation.js"></script>
    <script src="js/imageUploader.js"></script>
    <script src="js/api.js"></script>
    <script src="js/date.js"></script>
    <script defer>

        //### DÉCLARATION DES VARIABLES GLOBALS ####


        let previousScrollPosition = 0;
        let appendMode = false;
        let connected = false;
        let allUsers;
        let hideSearchBar = true;
        let imageIdToDelete = 0;
        let selectedCategory = "";
        let imagesCount = 50;
        let appendCount = 3;
        let holdCheckETag = false;
        let currentETag = "";
        let createMode = true;
        let searchCategory = "";
        let searchTitle = "";
        let descendant = false;

        init_UI();
        HEAD(checkETag, error);
        GET_ALL(RefreshCategoryList, error, "?fields=UserId,Username");
        $(".fa-refresh").click(getImagesList);

        function checkETag(ETag) {
            if (!holdCheckETag && ETag != currentETag) {
                currentETag = ETag;
                getImagesList();
            }
        }

        //########################################

        // ###   RAFRAICHISSEMENT   ###########################################################################################################################################################

        function RefreshCategoryList(users) {
            allUsers = users;
            $("#searchCategory").empty();
            $("#searchCategory").append("<option value=''>Toutes les catégories</option>");
            for (let item of users) {
                let id = item.UserId;
                let username = item.Username;
                let selected = (selectedCategory == username ? " selected " : "");
                $("#searchCategory").append(
                    `<option value='${id}' ${selected}>${username}</option>`
                );
            }
            getImagesList();
        }
        function refreshimagesList(images, ETag) {
            function insertIntoImageList(image) {
                let user = retrieveLoggeduser();
                let name;
                $(".image").click(e => { showImage(e) });
                $(".image").hover(function () {
                    $(this).css('cursor', 'pointer');
                }, function () {
                    $(this).css('cursor', 'auto');
                });

                if (user != null && user.Id == image.UserId && user.VerifyCode == "verified") {
                    $("#imagesList").append(
                        $(`<div class='imageLayout'>
                                        <div class='imageHeader'>
                                            <div class="imageTitle">${image.Title}</div>
                                        
                                            <div    class="cmd editCmd  fa fa-pencil-square" id="editCmd"
                                                        imageid="${image.Id}" 
                                                        title="Editer ${image.Title}" 
                                                        data-toggle="tooltip">
                                                </div>
                                                <div    class="cmd deleteCmd fa fa-window-close"  id="deleteCmd"
                                                        imageid="${image.Id}" 
                                                        title="Effacer ${image.Title}" 
                                                        data-toggle="tooltip">
                                                </div>
                                            </div>

                                            <div    id="image-container" class='image' imageid="${image.Id}" 
                                                    style="background-image:url('${image.ThumbnailURL}')">
                                                    
                                                    <img src="${image.AvatarURL}" class='avatar' alt="user_avatar" title="${user.Name}" data-toggle="tooltip">
                                                    ${image.Shared ? "<img src=images/sharedicon.png class='shared-icon' alt=sharing_icon>" : ""}
                                            </div>
                                        </a>
                                        <div class="imageDate">${convertToFrenchDate(parseInt(image.Date))}</div>
                                    </div>`)
                    );
                }
                else {
                    if (image.Shared) {
                        $("#imagesList").append(
                            $(`<div class='imageLayout'>
                                            <div class='imageHeader'>
                                                <div class="imageTitle">${image.Title}</div>
                                                </div>
                                                <div    class='image' imageid="${image.Id}"
                                                        style="background-image:url('${image.ThumbnailURL}')">
                                                    
                                                        <img src="${image.AvatarURL}" class='avatar' alt="user_avatar"title="${image.Username}" data-toggle="tooltip">
                                                </div>
                                            </a>
                                            <div class="imageDate">${convertToFrenchDate(parseInt(image.Date))}</div>
                                        </div>`)
                        );
                    }
                }
            }

            currentETag = ETag;
            previousScrollPosition = $(".scrollContainer").scrollTop();
            if (!appendMode) $("#imagesList").empty();

            if (appendMode && images.length == 0)
                imagesCount -= appendCount;

            for (let image of images) {
                insertIntoImageList(image);
            }

            $(".scrollContainer").scrollTop(previousScrollPosition);
            $(".editCmd").off();
            $(".deleteCmd").off();
            $(".showMore").off();
            $(".editCmd").click(e => { editimage(e) });
            $(".deleteCmd").click(e => { deleteimage(e) });
            $(".headerLayout");
            $('[data-toggle="tooltip"]').tooltip();
        }
        function refreshPage() {
            initHeaderPannel()
            getImagesList()
        }
        function initHeaderPannel() {
            let user = retrieveLoggeduser()

            if (user) {
                $("#disconnected-header").hide();
                $("#connected-header").show();
                $("#profileAvatar").attr("src", user.AvatarURL);;
                $("#profileName").text(user.Name);

                if (user.VerifyCode != "verified") {
                    $("#newImageCmd").hide();
                    $("#verifyCmd").show();
                    $("newImageCmd").hide();
                }
                else {
                    $("#verifyCmd").hide();
                    $("newImageCmd").show();
                    $("#newImageCmd").show();
                }
            }
            else {
                $("#newImageCmd").hide();
                $("#connected-header").hide();
                $("#newImageCmd").hide();
                $("#disconnected-header").show();
            }
        }
        function getImagesList(refresh = true) {
            let queryString = "";
            let searchTitle = $("#searchTitle").val();
            let selectedCategory = $("#searchCategory").val();

            if (refresh) {
                if (descendant) {
                    queryString = `sort=Date,desc&offset=0&limit=${imagesCount}`;
                } else {
                    queryString = `sort=Date,asc&offset=0&limit=${imagesCount}`;
                }
            } else {
                imagesCount += appendCount;
                if (descendant) {
                    queryString = `sort=Date,desc&offset=${Math.trunc(imagesCount / appendCount)}&limit=${appendCount}`;
                } else {
                    queryString = `sort=Date,asc&offset=${Math.trunc(imagesCount / appendCount)}&limit=${appendCount}`;
                }
            }

            if (selectedCategory !== "") {
                queryString += `&UserId=${selectedCategory}`;
            }
            if (searchTitle !== "") {
                queryString += `&keywords=${searchTitle}`;
            }

            GET_ALL(refreshimagesList, error, queryString);
        }

        //####################################################################################################################################################################################

        //###   FILTRAGE   ###################################################################################################################################################################

        function Ascendant() {
            if (descendant)
                descendant = false;
            else
                descendant = true;
            getImagesList();
        }

        //####################################################################################################################################################################################



        function error(status) {
            let errorMessage = "";
            switch (status) {
                case 0:
                    errorMessage = "Le service ne répond pas";
                    break;
                case 401:
                    errorMessage = "Requête non autorisée";
                    break;
                case 400:
                case 422:
                    errorMessage = "Requête invalide";
                    break;
                case 404:
                    errorMessage = "Service ou données introuvables";
                    break;
                case 409:
                    errorMessage = "Conflits de données: Hyperlien existe déjà";
                    break;
                case 500:
                    errorMessage = "Erreur interne du service";
                    break;
                default:
                    errorMessage = "Une erreur est survenue";
                    break;
            }
            $("#errorMessage").text(errorMessage);
            $("#errorDlg").dialog('open');
        }
        function showCreators() {
            holdCheckETag = true;
            createMode = false;

            $("#CreatorsDlg").dialog('option', 'title', 'Auteurs de PICT-CLOUD');
            $("#CreatorsDlg").dialog('open');

        }

        //###   GESTION DE COMPTE   ###########################################################################################################################################################

        function newAccount() {
            holdCheckETag = true;
            createMode = true;
            resetAccountForm();
            ImageUploader.imageRequired('avatar', true);
            $("#AccountCreationDlg").dialog('option', 'title', "Création de compte");
            $("#deleteAccountButton").hide();
            $("#AccountDlgOkBtn").text("Créer");
            $("#AccountCreationDlg").dialog('open');

        }
        function accountLogin() {
            holdCheckETag = true;
            createMode = true;
            loginForm();
            $("#AccountLoginDlg").dialog('option', 'title', "Connexion");
            $("#AccountLoginDlg").dialog('open');
        }
        function accountLogout() {
            holdCheckETag = true;
            createMode = true;

            $("#AccountLogoutDlg").dialog('option', 'title', "Déconnexion");
            $("#LogoutMessage").text("Voulez-vous vraiment quitter?");
            $("#AccountLogoutDlg").dialog("open");

        }
        function editAccount() {
            holdCheckETag = true;
            createMode = false;
            let user = retrieveLoggeduser();
            //manque le account form info
            $("#Id_input").val(user.Id);
            $("#Avatar_GUID_input").val(user.AvatarGUID);
            $("#username_input").val(user.Name);
            ImageUploader.setImage('avatar', user.AvatarURL);
            $("#emailreg_input").val(user.Email);
            $("#AccountCreationDlg").dialog('option', 'title', 'Modification du compte');
            $("#deleteAccountButton").show();
            $("#AccountDlgOkBtn").text("Modifier");
            $("#AccountDlgDeleteBtn").text("Modifier");
            $("#AccountCreationDlg").dialog('open');
        }
        function VerifyAccount() {
            holdCheckETag = true;
            createMode = false;

            $("#EmailVerification").dialog('open');
        }

        //####################################################################################################################################################################################

        //###   GESTION D'IMAGE   ############################################################################################################################################################

        function newImage() {
            holdCheckETag = true;
            createMode = true;
            resetimageForm();
            ImageUploader.imageRequired('image', true);
            $("#imageDlg").dialog('option', 'title', "Ajout d'image");
            $("#imageDlgOkBtn").text("Ajouter");
            $("#imageDlg").dialog('open');
        }

        function editimage(e) {
            holdCheckETag = true;
            createMode = false;

            let imageToEdit = null;
            imageIdToEdit = e.target.getAttribute("imageid");

            GET_IMAGE_BY_ID(
                imageIdToEdit,
                img => {
                    imageToEdit = img;

                    imageToForm(imageToEdit);

                    $("#imageDlg").dialog('option', 'title', "Modification d'image");
                    $("#imageDlgOkBtn").text("Modifier");
                    $("#imageDlg").dialog('open');
                }
            )
        }
        function deleteimage(e) {
            holdCheckETag = true;
            imageIdToDelete = e.target.getAttribute("imageid")
            GET_IMAGE_BY_ID(
                imageIdToDelete,
                image => {
                    $("#confirmationMessage").html("Voulez-vous vraiment effacer l'image <br><b>" + image.Title + "</b>?")
                },
                error
            );
            holdCheckETag = true;
            $("#confirmDlg").dialog('option', 'title', "Retrait d'image'...");
            $("#confirmDeleteImgDlgOkBtn").text("Effacer");
            $("#confirmDeleteImgDlg").dialog('open');
        }
        function showImage(e) {
            holdCheckETag = true;
            createMode = false;

            let imgToShow = null;
            imageIdToShow = e.target.getAttribute("imageid");

            GET_IMAGE_BY_ID(
                imageIdToShow,
                img => {
                    imgToShow = img;

                    imageToShow(imgToShow);

                    $("#imageShownDlg").dialog('option', 'title', "Affichage d'image");
                    $("#imageShownDlg").dialog('open');
                },
                error
            );
        }

        //###   FORMULAIRES DE COMPTE   ######################################################################################################################################################

        function resetAccountForm() {
            $("#Id_input").val(0);
            $("#Avatar_GUID_input").val("");
            $("#username_input").val("");
            $("#email_input").val("");
            $("#password_input").val("");
            $("#confirmation_input").val("");
            ImageUploader.resetImage('avatar');
        }
        function accountFromForm() {
            if ($("#CreationForm")[0].checkValidity()) {
                let account = {
                    Id: $("#Id_input").val(0),
                    AvatarGUID: $("#Avatar_GUID_input").val(),
                    Name: $("#username_input").val(),
                    Email: $("#emailreg_input").val(),
                    Password: $("#passwordreg_input").val(),
                    ImageData: ImageUploader.getImageData('avatar')
                };
                return account;
            } else {
                $("#CreationForm")[0].reportValidity()
            }
            return false;
        }
        function loginForm() {
            let account = {
                Email: $("#email_input").val(),
                Password: $("#password_input").val()
            };
            return account;
        }

        //####################################################################################################################################################################################

        //###   FORMULAIRES D'IMAGES   #######################################################################################################################################################

        function resetimageForm() {
            $("#Id_input").val("0");
            $("#GUID_input").val("");
            $("#date_input").val(Date.now());
            $("#title_input").val("");
            $("#description_input").val("");
            ImageUploader.resetImage('image');
        }
        function imageFromForm() {
            let connectedProfile = retrieveLoggeduser()

            if ($("#imageForm")[0].checkValidity()) {
                let image = {
                    Id: parseInt($("#Id_input").val()),
                    GUID: $("#GUID_input").val(),
                    Title: $("#title_input").val(),
                    Description: $("#description_input").val(),
                    ImageData: ImageUploader.getImageData('image'),
                    Date: parseInt($("#date_input").val()),
                    UserId: connectedProfile.Id,
                    Shared: $("#shared_input").is(":checked")
                };
                return image;
            } else {
                $("#imageForm")[0].reportValidity()
            }
            return false;
        }
        function imageToForm(image) {
            $("#Id_input").val(image.Id);
            $("#GUID_input").val(image.GUID);
            $("#date_input").val(image.Date);
            //$("#date_input").val(Date.now());
            $("#title_input").val(image.Title);
            $("#description_input").val(image.Description);
            $("#shared_input").prop("checked", image.Shared);
            ImageUploader.setImage('image', image.OriginalURL);
        }

        //####################################################################################################################################################################################

        //###   MÉTHODES DIVERSES JAVASCRIPT   #######################################################################################################################################################

        function imageToShow(image) {
            $("#avatar_shown").prop("src", image.AvatarURL);
            $("#username_shown").text(image.Username);
            $("#title_shown").text(image.Title);
            $("#description_shown").text(image.Description);
            $("#image_shown_link").prop("href", image.OriginalURL);
            $("#image_shown").prop("src", image.OriginalURL);
            $("#date_shown").text(convertToFrenchDate(parseInt(image.Date)));
        }

        //###   INITIALISATION DU UI   #######################################################################################################################################################

        function init_UI() {

            //### DÉCLARATION DES CALLBACKS ####

            loggedUser = retrieveLoggeduser()
            initHeaderPannel() //Afficher les informations de l'usager
            $("#header-logo").click(showCreators)
            $("#header-logo").hover(function () {
                $(this).css('cursor', 'pointer');
            }, function () {
                $(this).css('cursor', 'auto');
            });
            $("#sortCmd").click(Ascendant)
            $("#newImageCmd").click(newImage)
            $("#subscribeCmd").click(newAccount)
            $("#loginCmd").click(accountLogin)
            $("#logoutCmd").click(accountLogout)
            $("#profileDataCmd").click(editAccount)
            $("#verifyCmd").click(VerifyAccount)
            $("#searchCategory").change(() => { selectedCategory = $("#searchCategory").val(); getImagesList(); })
            $(".fa-search").click(e => {
                hideSearchBar = !hideSearchBar;
                if (hideSearchBar)
                    $("#searchBar").hide();
                else
                    $("#searchBar").show();

            })

            //#############################

            //###   DIALOG DE COMPTE   ####

            $("#AccountCreationDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 640,
                minWidth: 640,
                maxWidth: 640,
                height: 780,
                minHeight: 780,
                maxHeight: 780,
                position: { my: "center", at: "center", of: window },
                buttons: [{
                    id: "AccountDlgOkBtn",
                    text: "Title will be changed dynamically",
                    click: function () {
                        //accountfromform function a faire
                        let account = accountFromForm();
                        if (account) {
                            if (createMode) {
                                REGISTER(account, refreshPage, error);
                                $(this).dialog("close");
                                $("#EmailVerification").dialog('open');
                            }
                            else {
                                let tempuser = retrieveLoggeduser();
                                account.Id = tempuser.Id;
                                MODIFY(account, refreshPage, error);

                                $(this).dialog("close");
                            }
                        }
                    }
                }, {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }, {
                    //enlever compte
                    text: "Desinscrire",
                    id: "deleteAccountButton",
                    click: function () {
                        let account = accountFromForm();
                        holdCheckETag = false;
                        $("#confirmDeleteAccountDlg").dialog('open');
                        $(this).dialog("close");
                    }
                }]
            });
            $("#AccountLogoutDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 320,
                minWidth: 320,
                maxWidth: 320,
                height: 200,
                minHeight: 200,
                maxHeight: 200,
                position: { my: "center", at: "center", of: window },
                buttons: [{
                    id: "LoginDlgOkBtn",
                    text: "Déconnecter",
                    click: function () {
                        LOGOUT(refreshPage, error);
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }, {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");

                    }

                }]

            })
            $("#AccountLoginDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 320,
                minWidth: 320,
                maxWidth: 320,
                height: 390,
                minHeight: 390,
                maxHeight: 390,
                position: { my: "center", at: "center", of: window },
                buttons: [{
                    id: "LoginDlgOkBtn",
                    text: "Connecter",
                    click: function () {
                        let account = loginForm();

                        if (account) {
                            LOGIN(account, refreshPage, error);
                            connected = true;
                        }
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }, {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }]
            })
            $("#EmailVerification").dialog({
                title: "Vérification de courriel",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 330,
                minWidth: 330,
                maxWidth: 330,
                height: 345,
                minHeight: 345,
                maxHeight: 345,
                position: { my: "center", at: "center", of: window },
                buttons: [{
                    id: "EmailVerifDlgOkBtn",
                    text: "Envoyer",
                    click: function () {

                        let codeverif = $("#Verification_input").val()
                        VERIFY(codeverif, refreshPage, error);
                        $(this).dialog("close");
                    }
                },
                {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }]
            });
            $("#confirmDeleteAccountDlg").dialog({
                title: "Attention!",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 500, minWidth: 500, maxWidth: 500,
                height: 230, minHeight: 230, maxHeight: 230,
                position: { my: "top", at: "top", of: window },
                buttons: [{
                    id: "confirmDeleteDlgOkBtn",
                    text: "Oui",
                    click: function () {
                        holdCheckETag = false;
                        let account = retrieveLoggeduser();
                        if (account)
                            LOGOUT(refreshPage, error);
                        DELETE_USER(account.Id, refreshPage, error);
                        $(this).dialog("close");
                    }
                },
                {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;

                        $(this).dialog("close");
                    }
                }]
            });

            //#############################

            //###   DIALOG D'IMAGE   ####

            $("#imageDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 640,
                minWidth: 640,
                maxWidth: 640,
                height: 820,
                minHeight: 820,
                maxHeight: 820,
                position: { my: "top", at: "top", of: window },
                buttons: [{
                    id: "imageDlgOkBtn",
                    text: "Title will be changed dynamically",
                    click: function () {
                        let image = imageFromForm();
                        if (image) {
                            if (createMode) {
                                POST(image, refreshPage, error);
                                $(".scrollContainer").scrollTop(0);
                            }
                            else
                                PUT(image, refreshPage, error);
                            resetimageForm();
                            holdCheckETag = false;
                            $(this).dialog("close");
                        }
                    }
                },
                {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }]
            });
            $("#imageShownDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 640,
                minWidth: 640,
                maxWidth: 640,
                height: 820,
                minHeight: 820,
                maxHeight: 820,
                position: { my: "top", at: "top", of: window },
                buttons: [
                    {
                        text: "Annuler",
                        click: function () {
                            holdCheckETag = false;
                            $(this).dialog("close");
                        }
                    }]
            });
            $("#confirmDeleteImgDlg").dialog({
                title: "Attention!",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 500, minWidth: 500, maxWidth: 500,
                height: 230, minHeight: 230, maxHeight: 230,
                position: { my: "top", at: "top", of: window },
                buttons: [{
                    id: "confirmDeleteImgDlgOkBtn",
                    text: "Oui",
                    click: function () {
                        holdCheckETag = false;
                        if (imageIdToDelete)
                            DELETE_IMAGE(imageIdToDelete, refreshPage, error);
                        imageIdToDelete = 0;
                        $(this).dialog("close");
                    }
                },
                {
                    text: "Annuler",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }]
            });

            //#############################

            //###   DIALOG DIVERS   ####

            $("#CreatorsDlg").dialog({
                title: "...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 500, minWidth: 500, maxWidth: 500,
                height: 500, minHeight: 500, maxHeight: 500,
                position: { my: "top", at: "top", of: window },
                buttons: [{
                    text: "Fermer",
                    click: function () {
                        holdCheckETag = false;
                        $(this).dialog("close");
                    }
                }]
            });
            $("#errorDlg").dialog({
                title: "Erreur...",
                autoOpen: false,
                modal: true,
                show: { effect: 'fade', speed: 400 },
                hide: { effect: 'fade', speed: 400 },
                width: 500, minWidth: 500, maxWidth: 500,
                height: 230, minHeight: 230, maxHeight: 230,
                position: { my: "top", at: "top", of: window },
                buttons: [{
                    text: "Fermer",
                    click: function () {
                        holdCheckETag = false;
                        imageIdToDelete = 0;
                        $(this).dialog("close");
                    }
                }]
            });

            //#############################

            $(".scrollContainer").scroll(function () {
                if ($(".scrollContainer").scrollTop() + $(".scrollContainer").innerHeight() >= $("#imagesList").height()) {
                    getImagesList(false);
                }
            });
        }

        //####################################################################################################################################################################################
    </script>

</body>

</html>